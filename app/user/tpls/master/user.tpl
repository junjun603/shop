{x2;if:!$userhash}{x2;include:header}<body><style type="text/css">	*{margin:0;padding:0;}	.a1{		text-decoration: none;		color: #333;		display: block;		margin-top: 20px;		margin-left: 20px;		border: 1px dashed;		width: 80px;		height: 40px;		text-align: center;		line-height: 40px;	}	.waiting{		position: fixed;		top:0;		left:0;		right:0;		bottom:0;		background: rgba(0, 0, 0, 0.6);		display: none;		z-index: 998;	}	.selected_purchaser,.to_selected_purchaser{		position: absolute;		top:55px;		left:110px;		background: #fff;	}	.to_selected_purchaser{		top:12px;	}	#selected_content,#to_selected_content{		height: 30px;		margin: 0;		border: 1px solid #66afe9;		width: 220px;		border-radius: 4px;	}	.content_p,.to_content_p{		border: 1px solid #66afe9;		width: 220px;		border-radius: 2px;		margin-top: 2px;		display: none;	}	.content_p p,.to_content_p p{		margin: 0;		height: 30px;		position: relative		padding-top: 5px;		margin-bottom: 10px;	}	.content_p p .search_input, .to_content_p p .to_search_input{		height: 30px;		width: 90%;		border-radius: 4px;		text-indent: 5px;		border: 1px solid #66afe9;		position: absolute;		left: 4%;	}	ul.all_content,ul.to_all_content{		margin:0;		padding:0;		border-top: 0;		border-radius: 4px;		margin-top: -2px;		padding-top: 2px;		border-top: .5px solid #a6ccea;		list-style: none;		height: 110px;		overflow-y: scroll;	}	.content_item,.to_content_item{		padding:4px 0 4px 8px;		height:35px;		line-height: 35px;		border-bottom: .5px solid #a6ccea;	}	.content_item:last-child,.to_content_item:last-child{		border-bottom: none;	}	.content_item:hover, .to_content_item:hover{		background-color: #337ab7;		color:#fff;	}	 .edit_div{		 background:#fff;		 min-height:260px;	     min-width:400px;	     border:1px solid #ccc;		 position:absolute;		 top:10%;         left:30%;		 border-radius:4px;		 z-index:999;	 }	.edit_div .edit_title{		height:50px;		line-height:50px;		color:#000;		border-bottom:1px solid #ccc;		text-align:center;		font-size:28px;	}	.edit_div .edit_close{		cursor:pointer;		color:#ccc;		position:absolute;		right:5px;		top:5px;		width:20px;		height:20px;		line-height:20px;	}	.edit_div .edit_body{		position:relative;		height:100px;		line-height:100px;		text-indent:20px;		color:#333;		font-size:20px;	}	.edit_div .edit_body .please_choice{		padding-right:10px;		position:absolute;		top:20px;	}	.edit_div .edit_body .to_choice{		 padding-right:10px;		 position:absolute;		 top:-20px;	 }	.edit_div .edit_body .to_choice #selected_content,.edit_div .edit_body .to_choice #to_selected_content{		font-size:18px;		width:230px;		height:40px;		border-radius:4px;		border:1px solid #ccc;		text-indent:4px	}    .edit_div .edit_footer{        text-align: center;        margin-top: 20px;    }	.edit_div .edit_footer .to_choice #selected_content{		text-align:center;		height:100px;		line-height:100px;		color:#ccc;		border-top:1px solid #ccc;	}	.edit_div .edit_footer span{		height:40px;		display:inline-block;		line-height:40px;		border-radius:4px;		background:#337ab7;		color:#fff;		cursor:pointer;		padding:0px 12px;		font-size:20px	}	.edit_div  .edit_cancel{		background:rgb(198, 198, 198);		margin-left:5px	}	.edit_div .edit_close:hover{		transition:1s;		transform:rotate(180deg);		transform-origin:center;		background:#f00;		/* unhover		transform':'rotate(-180deg)',"transform-origin":"center","background":"#fff		*/	}	/*curEditDivTop  curEditDivLeft*/</style>{x2;include:nav}<div class="container-fluid">	<div class="row-fluid">		<div class="main">			<div class="col-xs-2" style="padding-top:10px;margin-bottom:0px;">                {x2;include:menu}			</div>			<div class="col-xs-10" id="datacontent">	{x2;endif}				<div class="box itembox" style="margin-bottom:0px;border-bottom:1px solid #CCCCCC;">					<div class="col-xs-12">						<ol class="breadcrumb">							<li><a href="index.php?{x2;$_app}-master">{x2;$apps[$_app]['appname']}</a></li>							<li class="active">用户管理</li>						</ol>					</div>				</div>				<div class="box itembox" style="padding-top:10px;margin-bottom:0px;">					<h4 class="title" style="padding:10px;">						用户列表						<span class="pull-right">							<a data-toggle="dropdown" class="btn btn-primary dropdown-toggle" href="#">添加用户&nbsp;<strong class="caret"></strong></a>							<ul class="dropdown-menu">								<li><a href="index.php?user-master-user-add">单个用户</a></li>								<li><a href="index.php?user-master-user-batadd">从csv文件导入</a></li>							</ul>						</span>					</h4>					<form action="index.php?user-master-user" method="post" style="margin-top:10px;" class="form-inline">						<table class="table">					        <tr>								<td style="border-top:0px;">									用户ID：								</td>								<td style="border-top:0px;">									<input name="search[userid]" class="form-control" size="15" type="text" class="number" value="{x2;$search['userid']}"/>								</td>								<td style="border-top:0px;">									注册时间：								</td>								<td style="border-top:0px;">									<input class="form-control datetimepicker" data-date="{x2;date:TIME,'Y-m-d'}" data-date-format="yyyy-mm-dd" type="text" name="search[stime]" size="10" id="stime" value="{x2;$search['stime']}"/> - <input class="form-control datetimepicker" data-date="{x2;date:TIME,'Y-m-d'}" data-date-format="yyyy-mm-dd" size="10" type="text" name="search[etime]" id="etime" value="{x2;$search['etime']}"/>								</td>								<td style="border-top:0px;">									用户名：								</td>								<td style="border-top:0px;">									<input class="form-control" name="search[username]" size="15" type="text" value="{x2;$search['username']}"/>								</td>							</tr>					        <tr>								<td>									电子邮箱：								</td>					        	<td>					        		<input class="form-control" name="search[useremail]" size="15" type="text" value="{x2;$search['useremail']}"/>					        	</td>					        	<td>									用户组：								</td>								<td>									<select name="search[groupid]" class="form-control">								  		<option value="0">不限</option>								  		{x2;tree:$groups,group,gid}								  		<option value="{x2;v:group['groupid']}"{x2;if:$search['groupid'] == v:group['groupid']} selected{x2;endif}>{x2;v:group['groupname']}</option>								  		{x2;endtree}							  		</select>								</td>								<td>									<button class="btn btn-primary" type="submit">提交</button>								</td>								<td>								<!--<a href="javascript:void(0)" id="message_copy" >复制</a>-->									<!--                                    <button class="btn btn-primary" onclick="batchUpdateRole()">批量更改用户角色</button>                                    -->								</td>					        </tr>						</table>						<div class="input">							<input type="hidden" value="1" name="search[argsmodel]" />						</div>					</form>					<form action="index.php?user-master-user-batdel" method="post">						<table class="table table-hover table-bordered">							<thead>								<tr class="info">									<th><input type="checkbox" class="checkall" target="delids"/></th>									<th>ID</th>									<th>用户名</th>									<th>电子邮件</th>									<th>注册IP</th>                                    <!--									<th>积分点数</th>									-->									<th>角色</th>									<th>注册时间</th>									<th>操作</th>								</tr>							</thead>							<tbody>								{x2;tree:$users['data'],user,uid}								<tr>									<td>{x2;if:v:user['userid'] != $_user['userid']}<input type="checkbox" name="delids[{x2;v:user['userid']}]" value="1">{x2;endif}</td>									<td>{x2;v:user['userid']}</td>									<td>{x2;v:user['username']}</td>									<td>{x2;v:user['useremail']}</td>                                    <td>{x2;v:user['userregip']}</td>                                    <!--									<td>{x2;v:user['usercoin']}</td>                                    -->                                    <td>{x2;$groups[v:user['usergroupid']]['groupname']}</td>									<td>{x2;date:v:user['userregtime'],'Y-m-d'}</td>									<td>										<div class="btn-group">											<a class="btn" href="index.php?user-master-user-modify&userid={x2;v:user['userid']}&page={x2;$page}{x2;$u}"><em class="glyphicon glyphicon-edit"></em></a>											{x2;if:v:user['userid'] != $_user['userid']}											<a msg="删除后不能恢复，您确定要进行此操作吗？" class="btn confirm" href="index.php?user-master-user-del&userid={x2;v:user['userid']}&page={x2;$page}{x2;$u}"><em class="glyphicon glyphicon-remove"></em></a>											{x2;endif}										</div>									</td>								</tr>								{x2;endtree}							</tbody>						</table>						<div class="form-group">				            <div class="controls">					            <label class="radio-inline">					                <input type="radio" name="action" value="delete" checked/>删除					            </label>					            {x2;tree:$search,arg,sid}					            <input type="hidden" name="search[{x2;v:key}]" value="{x2;v:arg}"/>					            {x2;endtree}					            <label class="radio-inline">					            	<button class="btn btn-primary" type="submit">提交</button>					            </label>					        </div>				        </div>					</form>					<ul class="pagination pull-right">						{x2;$users['pages']}					</div>				</div>			</div>{x2;if:!$userhash}		</div>	</div></div><div id="waiting" class="waiting"></div>{x2;include:footer}</body><script>      function batchUpdateRole(){ //批量更改用户角色          editWidge($('#waiting')[0],'批量设置用户角色');          // $.ajax({          //     type:"get",          //     url:'index.php?user-master-user-batupdate',          //     success:function(res){          //         var resObj = JSON.parse(res);          //     },          //     error:function(){          //         alert('网络错误');          //     }          // })      }    var g_purchaser_list = []; //全局采购者列表        $('#waiting').on('click',function(){            var bgDisplay = $('#waiting').css("display");            bgDisplay=='none'?$('#waiting').css("display","block"):$('#waiting').css("display","none");            $('.edit_div').remove();        });        function editText(obj,title){ //编辑框文本            $('.edit_div').remove();            var editStr = '<div class="edit_div">';            editStr += '<div class="edit_title"><span class="title_content">'+title+'</span>';            editStr += '<span class="edit_close">X</span></div>';            editStr += '<div class="edit_body">';            editStr +=     '<span class="please_choice">角色</span>';            editStr +=      '<div class="selected_purchaser">';            editStr +=          '<div id="selected_content"></div>';            editStr +=          '<div class="content_p">';            editStr +=              '<p>';            editStr +=                  '<input placeholder="搜索" type="text" class="search_input">';            editStr +=              '</p>';            editStr +=              '<ul class="all_content">';            editStr +=                  '<li class="content_item">smile</li>';            editStr +=              '</ul>';            editStr +=          '</div>';            editStr +=      '</div>';            editStr +=      '<span class="to_choice">用户</span>';            editStr +=      '<div class="to_selected_purchaser">';            editStr +=          '<div id="to_selected_content"></div>';            editStr +=          '<div class="to_content_p">';            editStr +=              '<p>';            editStr +=              '<input placeholder="搜索" type="text" class="to_search_input">';            editStr +=              '</p>';            editStr +=              '<ul class="to_all_content">';            editStr +=                  '<li class="to_content_item">smile</li>';            editStr +=              '</ul>';            editStr +=          '</div>';            editStr +=      '</div>';            editStr += '</div>';            editStr += '<div class="edit_footer">';            editStr +=      '<span class="edit_save">确定</span>';            editStr +=      '<span class="edit_cancel">取消</span>';            editStr += '</div>';            editStr += '</div>';            $(obj).after(editStr);        }        function editStyle(obj){            var parentHeight = $(obj).height();//td高            var parentwidth = $(obj).width();//            var parentTop = $(obj).offset().top;//距离顶部            var parentLeft = $(obj).offset().left;//距离窗口左边缘            //设置样式            var editDiveStyle = document.getElementsByClassName('edit_div')[0];            var curEditDivTop = (parentHeight-300)/2+'px'; //编辑框顶部            var curEditDivLeft = (parentwidth-400)/2+'px';//编辑框 左部        }        function editEvent(){            //编辑框的关闭按钮            $(document).on('mouseover mouseout click','.edit_close',function (event) {                if(event.type == "click"){                    event.stopPropagation();                    $('.edit_div').remove();                    $('#waiting').css("display","none")                }            })            //确定和取消            $(document).on('click','.edit_save,.edit_cancel',function (event) {                if($(this).attr('class') == "edit_save"){                    //被复制的采购者采购id                    var pur_id = $('#selected_content span').attr('purchaser_id')?$('#selected_content span').attr('purchaser_id'):-1;                    // 复制给谁的 采购id                    var to_pur_id = $('#to_selected_content span').attr('purchaser_id')?$('#to_selected_content span').attr('purchaser_id'):-1;                    $('.edit_div').remove();                    $('#waiting').css("display","none");                    // $('#loader').css("display","block");//遮罩层                    if(pur_id<0 || to_pur_id<-1){                        alert('您的选择信息不全');                        return;                    }                    alert('ok');                }else if($(this).attr('class') == "edit_cancel"){                    event.stopPropagation();                    $('.edit_div').remove();                    $('#waiting').css("display","none");                }                $(document).unbind('click');            })            //选择列表            var flag_content = false;            $('#selected_content,#to_selected_content').click(function(event){                var choiced_id = event['currentTarget']['id'];                var flag_id = 1;                if(choiced_id=='to_selected_content') flag_id = 2;              //  if(g_purchaser_list.length>0){                //    genPurchaserList(g_purchaser_list,flag_id);               // }else{                    console.log(flag_id);                    $.ajax({                        type: "get",                        dataType: 'json',           // 格式为json                        url: "index.php?user-master-user-getList&flag_id="+flag_id,                        success: function (data) {                            var dataobj = data;                            for(var i=0;i<dataobj.length;i++){                                var personal_info = new Object();                                var purchaser_id = dataobj[i]['id']; //采购者id                                var purchaser_name = ""+dataobj[i]['name']; //采购者姓名                                personal_info['id'] = purchaser_id;                                personal_info['name'] = purchaser_name;                              //  g_purchaser_list[g_purchaser_list.length] = personal_info;                            }                            genPurchaserList(dataobj,flag_id);                        }                    });              //  }            });            //生成列表   flag 确定是复制给谁的列表，还是被复制者的列表            function genPurchaserList(data,flag){                var liList = '';                if(flag==1){                    var be_copied = $('#to_selected_content span').text(); //被复制者                    for(var i=0;i<data.length;i++){                        //如果被复制者已经确定了，赋值给谁里面就不能有已经确定的了                        if(be_copied&&(be_copied==data[i]['name'])) continue;                        liList += ' <li class="content_item" purchaser_id='+data[i]['id']+'>'+data[i]['name']+'</li>';                    }                    $('.all_content').html(liList);                    flag_content = !flag_content;                    if(flag_content) $('.content_p').slideDown();                    else $('.content_p').slideUp();                    $('ul.all_content li').css("display","block");                }else if(flag==2){                    var to_copied = $('#selected_content span').text(); //复制给                    for(var i=0;i<data.length;i++){                        if(to_copied&&(to_copied==data[i]['name'])) continue;                        liList += ' <li class="to_content_item" purchaser_id='+data[i]['id']+'>'+data[i]['name']+'</li>';                    }                    $('.to_all_content').html(liList);                    flag_content = !flag_content;                    if(flag_content)$('.to_content_p').slideDown();                    else $('.to_content_p').slideUp();                    $('ul.to_all_content li').css("display","block");                }            }            //每个 点击，填充            $(document).on('click','.content_item,.to_content_item',function(event){ //                if(event['currentTarget']['className']=='content_item'){                    var cur_text = $(this).text();                    var purchaser_id =$(this).attr('purchaser_id');                    $('#selected_content').html('<span class="addTex" purchaser_id='+purchaser_id+'>'+cur_text+'</span>');                    $('.search_input').val('');                    $('.addTex').css("line-height","30px");                    $('.addTex').css("display","inherit");                    $('.content_p').slideUp();                    flag_content = false;                }else if(event['currentTarget']['className']=='to_content_item'){                    var cur_text = $(this).text();                    var purchaser_id =$(this).attr('purchaser_id');                    //console.log($('#to_selected_content').html());                    if($('#to_selected_content span').length>0){                        var eachcount=0;                        $('#to_selected_content span').each(function(){                            eachcount++                            var that = this;                            if($(that).text() == cur_text){                                alert('选择重复');                                return false;                            }                            if(eachcount>=$('#to_selected_content span').length){                                var sed = $('#to_selected_content span.addTex').text();                                var sedId = $('#to_selected_content span.addTex').attr('purchaser_id');                                sed += ','+cur_text;                                sedId += ','+purchaser_id;                                $('#to_selected_content').html('<span class="addTex" purchaser_id='+sedId+'>'+sed+'</span>');                            }                        })                    }else{                        $('#to_selected_content').html('<span class="addTex" purchaser_id='+purchaser_id+'>'+cur_text+'</span>');                    }                    $('.to_search_input').val('');                    $('.addTex').css("line-height","30px");                    $('.addTex').css("display","inherit");                    $('.to_content_p').slideUp();                    flag_content = false;                }            });            //搜索            $(document).on('keyup','.search_input,.to_search_input',function(event){               // if(event['currentTarget']['className']=='search_input'){                if(true){                    // var inText = $(this).val();                    // if(event.keyCode==8 && inText){ //keyCode 8 是退格键                    //     $('ul.all_content li').each(function(){                    //         if($(this).text().indexOf(inText)>=0){                    //             $(this).css("display","block");                    //         }                    //     });                    // }else{                    //     $('ul.all_content li').each(function(){                    //         if(!inText) $(this).css("display","block});                    //         else if($(this).text().indexOf(inText)<0) $(this).css("display","none");                    //         else $(this).css("display","block");                    //     });                    // }                }else if(event['currentTarget']['className']=='to_search_input'){                    var inText = $(this).val();                    if(event.keyCode==8 && inText){ //keyCode 8 是退格键                        $('ul.to_all_content li').each(function(){                            if($(this).text().indexOf(inText)>=0){                                $(this).css("display","block");                            }                        });                    }else{                        $('ul.to_all_content li').each(function(){                            if(!inText) $(this).css("display","block");                            else if($(this).text().indexOf(inText)<0) $(this).css("display","none");                            else{                                $(this).css("display","block");                            }                        });                    }                }            });        }        function editWidge (obj,title){            //params :  编辑框            $('.waiting').css('display','block');            editText(obj,title); //编辑框文本            editStyle(obj);  //编辑框样式            editEvent();    //编辑框事件        }</script></html>{x2;endif}